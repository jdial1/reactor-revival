<!-- TOP NAVIGATION -->
<nav id="main_top_nav" class="nav-bar-row">
  <!-- Left Group: Navigation Links -->
  <ul class="nav-group-left">
    <li>
      <button data-page="reactor_section" class="active">Reactor</button>
    </li>
    <li>
      <button data-page="upgrades_section">Upgrades</button>
      <!-- Indicator dot injected via JS -->
    </li>
    <li>
      <button data-page="experimental_upgrades_section">Research</button>
    </li>
    <li>
      <button data-page="leaderboard_section" title="Leaderboard">üèÜ</button>
    </li>
  </ul>

  <!-- Center Group: Stats (Desktop) -->
  <ul id="reactor_stats" class="desktop-only">
    <li>
      <strong title="Total heat venting per tick">
        <img src="img/ui/icons/icon_vent.png" alt="Vent" class="icon-inline" />
        <span id="stats_vent">0</span>
      </strong>
    </li>
    <li>
      <strong title="Power per tick">
        <img src="img/ui/icons/icon_power.png" alt="Power" class="icon-inline" />
        <span id="stats_power">0</span>
      </strong>
    </li>
    <li>
      <strong title="Heat per tick">
        <img src="img/ui/icons/icon_heat.png" alt="Heat" class="icon-inline" />
        <span id="stats_heat">0</span>
      </strong>
    </li>
  </ul>

  <ul id="engine_status" class="desktop-only">
     <li>
        <strong title="Tick Rate">
            <img src="img/ui/icons/icon_time.png" alt="TPS" class="icon-inline" />
            <span id="tps_display">0</span>
        </strong>
     </li>
  </ul>

  <!-- Right Group: System Controls -->
  <ul class="nav-group-right">
    <li>
      <button id="user_account_btn" title="Account" aria-label="User Account">üë§</button>
    </li>
    <li>
      <button id="fullscreen_toggle" title="Toggle Fullscreen" aria-label="Toggle Fullscreen">‚õ∂</button>
    </li>
    <li>
      <button id="settings_btn" title="Settings" aria-label="Settings">‚öôÔ∏è</button>
    </li>
    <li>
      <button id="splash_close_btn" title="Exit to Title" aria-label="Exit to Title">‚úñ</button>
    </li>
  </ul>
</nav>

<!-- MAIN CONTENT -->
<main id="main">
  <!-- PARTS SIDEBAR -->
  <aside id="parts_section">
    <button id="parts_panel_toggle" aria-label="Toggle parts panel">‚ò∞</button>
    <div class="parts_header">
      <div class="parts_tabs">
        <button
          class="parts_tab active"
          id="tab_power"
          data-tab="power"
          title="Power Creation"
        >
          <img src="img/ui/icons/icon_power.png" alt="Power" />
        </button>
        <button
          class="parts_tab"
          id="tab_heat"
          data-tab="heat"
          title="Heat Management"
        >
          <img src="img/ui/icons/icon_heat.png" alt="Heat" />
        </button>
        <button
          id="parts_help_toggle"
          class="parts_help_btn"
          title="Toggle help mode - click to show part information instead of placing parts"
          aria-label="Toggle help mode"
        >
          ?
        </button>
      </div>
    </div>
    <div id="parts_tab_contents">
      <div id="parts_tab_power" class="parts_tab_content active">
        <hgroup>
          <h4>Cells</h4>
          <h6>Generate power and heat.</h6>
        </hgroup>
        <div id="cells" class="item-grid"></div>
        <hgroup>
          <h4>Reflectors</h4>
          <h6>Boost adjacent cell output.</h6>
        </hgroup>
        <div id="reflectors" class="item-grid"></div>
        <hgroup>
          <h4>Capacitors</h4>
          <h6>Increase reactor power capacity.</h6>
        </hgroup>
        <div id="capacitors" class="item-grid"></div>
        <hgroup>
          <h4>Particle Accelerators</h4>
          <h6>Generate Exotic Particles from heat.</h6>
        </hgroup>
        <div id="particleAccelerators" class="item-grid"></div>
      </div>
      <div id="parts_tab_heat" class="parts_tab_content">
        <hgroup>
          <h4>Vents</h4>
          <h6>Actively cool components.</h6>
        </hgroup>
        <div id="vents" class="item-grid"></div>
        <hgroup>
          <h4>Heat Exchangers</h4>
          <h6>Distribute heat between components.</h6>
        </hgroup>
        <div id="heatExchangers" class="item-grid"></div>
        <hgroup>
          <h4>Heat Inlets</h4>
          <h6>Move heat into the reactor core.</h6>
        </hgroup>
        <div id="heatInlets" class="item-grid"></div>
        <hgroup>
          <h4>Heat Outlets</h4>
          <h6>Move heat out of the reactor core.</h6>
        </hgroup>
        <div id="heatOutlets" class="item-grid"></div>
        <hgroup>
          <h4>Coolant Cells</h4>
          <h6>Absorb and contain heat.</h6>
        </hgroup>
        <div id="coolantCells" class="item-grid"></div>
        <hgroup>
          <h4>Reactor Plating</h4>
          <h6>Increase reactor heat capacity.</h6>
        </hgroup>
        <div id="reactorPlatings" class="item-grid"></div>
        <hgroup>
          <h4>Overflow Valves</h4>
          <h6>Transfer heat when input exceeds 80% containment.</h6>
        </hgroup>
        <div id="overflowValves" class="item-grid"></div>
        
        <hgroup>
          <h4>Top-up Valves</h4>
          <h6>Transfer heat when output drops below 20% containment.</h6>
        </hgroup>
        <div id="topupValves" class="item-grid"></div>
        
        <hgroup>
          <h4>Check Valves</h4>
          <h6>Transfer heat in one direction only.</h6>
        </hgroup>
        <div id="checkValves" class="item-grid"></div>
      </div>
    </div>
    <nav id="controls_nav">
      <button id="auto_sell_toggle" class="secondary outline" title="Auto Sell">
        <img src="img/ui/icons/icon_cash.png" alt="Auto Sell" class="control-icon" />
        <span class="control-text">Auto Sell</span>
      </button>
      <button id="auto_buy_toggle" class="secondary outline" title="Auto Buy">
        <img src="img/ui/icons/icon_cash_outline.svg" alt="Auto Buy" class="control-icon" />
        <span class="control-text">Auto Buy</span>
      </button>
      <button id="time_flux_toggle" class="secondary outline" title="Time Flux">
        <img src="img/ui/icons/icon_time.png" alt="Time Flux" class="control-icon" />
        <span class="control-text">Time Flux</span>
      </button>
      <button
        id="heat_control_toggle"
        class="secondary outline"
        title="Heat Ctrl"
      >
        <img src="img/ui/icons/icon_heat.png" alt="Auto Heat" class="control-icon" />
        <span class="control-text">Auto Heat</span>
      </button>
      <button id="pause_toggle" class="contrast" title="Pause/Play">
        <img src="img/ui/nav/nav_pause.png" alt="Pause" class="control-icon pause-icon" />
        <img src="img/ui/nav/nav_play.png" alt="Resume" class="control-icon play-icon" />
        <span class="control-text">Pause</span>
      </button>
      <button id="user_account_btn_mobile" class="secondary outline" title="Account">
        <span class="control-icon" style="font-size: 1.5em;">üë§</span>
        <span class="control-text">Account</span>
      </button>
    </nav>
  </aside>

      <div id="main_content_wrapper">
      <!-- Only show objectives on reactor page -->

      <!-- ENHANCED OBJECTIVES SECTION -->
      <div id="objectives_section">

        <!-- NEW ENHANCED OBJECTIVES UI -->
        <div id="objectives_container" class="mobile-objectives-container">

          <!-- ALWAYS VISIBLE HEADER (THE 'HANDLE' FOR THE DRAWER) -->
          <header id="objectives_header" class="objectives-header">
              <div class="objective-title-row">
                  <h2 id="objective_current_title" class="objective-title-compact"></h2>
              </div>
              <div class="objective-progress-row">
                  <div class="objective-progress-bar-container">
                      <div id="objective_current_progress_bar" class="objective-progress-bar"></div>
                  </div>
                  <div class="objectives-header-actions">
                      <button id="objective_claim_btn_compact" class="objective-claim-btn-compact" disabled>Claim</button>
                      <button id="objective_claim_chapter_btn_compact" class="objective-claim-btn-compact chapter-claim-btn-compact" disabled>Complete</button>
                      <button id="objectives_toggle_btn" class="objectives-toggle-btn" aria-label="Toggle Objectives">‚ñº</button>
                  </div>
              </div>
          </header>

          <!-- EXPANDABLE CONTENT PANEL -->
          <div id="objectives_content_panel" class="objectives-content-panel">
              <!-- Chapter Information -->
              <div class="objectives-chapter-info">
                  <h3 id="objective_chapter_title"></h3>
                  <div class="chapter-progress-container">
                      <div class="chapter-progress-bar-container">
                          <div id="objective_chapter_progress_bar" class="chapter-progress-bar"></div>
                      </div>
                      <span id="objective_chapter_progress_text"></span>
                  </div>
              </div>

              <hr class="objective-divider">

              <!-- Current Objective Details -->
              <div class="objective-details">
                  <p id="objective_current_description" class="objective-description"></p>
                  <p id="objective_flavor_text" class="objective-flavor-text" hidden></p>
                  <p id="objective_current_progress_text" class="objective-progress-text"></p>
                  <div id="objective_reward"></div>
              </div>

              <!-- Claim Buttons -->
              <button id="objective_claim_btn" class="objective-claim-btn" disabled>Claim Reward</button>
              <button id="objective_claim_chapter_btn" class="objective-claim-btn chapter-claim-btn" disabled>Complete Chapter</button>
          </div>
        </div>
      </div>

    <!-- End reactor-only objectives -->

    <div id="page_content_area">
      <!-- Content will be loaded dynamically -->
    </div>

    <!-- TOOLTIP -->
    <div id="tooltip" class="hidden">
      <div id="tooltip_data">
        <!-- Content injected by TooltipManager -->
      </div>
      <button id="tooltip_close_btn" title="Close" aria-label="Close tooltip">√ó</button>
    </div>
  </div>
</main>

<!-- Modal for Copy/Paste Data -->
<div id="reactor_copy_paste_modal" class="hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="reactor_copy_paste_modal_title">Reactor Layout</h3>
      <button id="reactor_copy_paste_close_btn" title="Close">√ó</button>
    </div>
    <textarea id="reactor_copy_paste_text" style="width:100%;min-height:80px;" placeholder="Paste reactor layout data here..."></textarea>
    <div id="reactor_copy_paste_cost"></div>
    <div class="modal-actions">
      <button id="reactor_copy_paste_confirm_btn" class="hidden">Action</button>
    </div>
  </div>
</div>
<!-- End Copy/Paste UI -->

<!-- INFO BAR (FOOTER) -->
<footer id="info_bar">
  <!-- Desktop Layout (Single Row) -->
  <div class="info-bar-desktop">
    <button
      class="info-item power"
      id="info_bar_power_btn_desktop"
      type="button"
      tabindex="0"
      aria-label="Sell Power"
    >
      <img src="img/ui/icons/icon_power.png" alt="Power" class="icon" />
      <span class="value" id="info_power_desktop">100</span>
      <span class="denom" id="info_power_denom_desktop">/100</span>
    </button>
    <span class="info-item money"
      ><img src="img/ui/icons/icon_cash.png" alt="Cash" class="icon" />
      <span class="value" id="info_money_desktop">20.6K</span></span
    >
        <span class="info-item ep" id="info_ep_desktop">
      <span class="ep-content" style="display: none;">
        <span class="icon">üß¨</span>
        <span class="value" id="info_ep_value_desktop">0</span>
      </span>
    </span>
    <button
      class="info-item heat"
      id="info_bar_heat_btn_desktop"
      type="button"
      tabindex="0"
      aria-label="Reduce Heat"
    >
      <img src="img/ui/icons/icon_heat.png" alt="Heat" class="icon" />
      <span class="value" id="info_heat_desktop">496</span>
      <span class="denom" id="info_heat_denom_desktop">/1K</span>
    </button>

  </div>

  <!-- Mobile Layout (Two Rows) -->
  <div class="info-bar-mobile">
    <div class="info-row info-main">
      <button
        class="info-item power"
        id="info_bar_power_btn"
        type="button"
        tabindex="0"
        aria-label="Sell Power"
      >
        <img src="img/ui/icons/icon_power.png" alt="Power" class="icon" />
        <span class="value" id="info_power">100</span>
      </button>
      <span class="info-item money"
        ><img src="img/ui/icons/icon_cash.png" alt="Cash" class="icon" />
        <span class="value" id="info_money">20.6K</span></span
      >
      <button
        class="info-item heat"
        id="info_bar_heat_btn"
        type="button"
        tabindex="0"
        aria-label="Reduce Heat"
      >
        <img src="img/ui/icons/icon_heat.png" alt="Heat" class="icon" />
        <span class="value" id="info_heat">496</span>
      </button>
    </div>
    <div class="info-row info-denom">
      <span class="info-item power"
        ><span class="denom" id="info_power_denom">/100</span></span
      >
                 <span class="info-item ep" id="info_ep">
             <span class="ep-content" style="display: none;">
               <span class="icon">üß¨</span>
               <span class="value" id="info_ep_value">0</span>
             </span>
           </span>
      <span class="info-item heat"
        ><span class="denom" id="info_heat_denom">/1K</span></span
      >
    </div>
  </div>
</footer>

<!-- BOTTOM NAV (MOBILE) -->
<footer id="bottom_nav">
  <nav>
    <ul>
      <li>
        <button data-page="reactor_section" class="secondary active">
          Reactor
        </button>
      </li>
      <li>
        <button data-page="upgrades_section" class="secondary">Upgrades</button>
      </li>
      <li>
        <button data-page="experimental_upgrades_section" class="secondary">
          Research
        </button>
      </li>
      <li>
        <button data-page="leaderboard_section" class="secondary" title="Leaderboard">üèÜ</button>
      </li>
    </ul>
  </nav>
</footer>
