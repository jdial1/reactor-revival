<nav id="main_top_nav" class="grid container-fluid nav-bar-row">
  <ul>
    <li>
      <a href="#" class="secondary" role="button" data-page="reactor_section"
        >Reactor</a
      >
    </li>
    <li>
      <a href="#" class="secondary" role="button" data-page="upgrades_section"
        >Upgrades</a
      >
    </li>
    <li>
      <a
        href="#"
        class="secondary"
        role="button"
        data-page="experimental_upgrades_section"
        >Research</a
      >
    </li>
  </ul>
  <ul id="reactor_stats">
    <li>
      <strong title="Estimated total heat venting per tick"
        ><img src="img/ui/icons/icon_vent.png" alt="Vent" class="icon-inline" /><span id="stats_vent">0</span></strong
      >
    </li>
    <li>
      <strong title="Total potential heat inletting per tick"
        ><img src="img/ui/icons/icon_inlet.png" alt="Inlet" class="icon-inline" /><span id="stats_inlet">0</span></strong
      >
    </li>
    <li>
      <strong title="Total potential heat outletting per tick"
        ><img src="img/ui/icons/icon_outlet.png" alt="Outlet" class="icon-inline" /><span id="stats_outlet">0</span></strong
      >
    </li>
    <li>
      <strong title="Estimated power per tick"
        ><img src="img/ui/icons/icon_power.png" alt="Power" class="icon-inline" /><span id="stats_power">0</span></strong
      >
    </li>
    <li>
      <strong title="Estimated heat per tick"
        ><img src="img/ui/icons/icon_heat.png" alt="Heat" class="icon-inline" /><span id="stats_heat">0</span></strong
      >
    </li>
    <li>
      <strong title="Total heat contained in all parts"
        ><img src="img/ui/icons/icon_heat.png" alt="Part Heat" class="icon-inline" /><span id="stats_total_part_heat">0</span></strong
      >
    </li>
  </ul>
  <ul id="engine_status">
    <li class="desktop-only">
      <strong title="Engine Status"
        ><img src="img/ui/icons/icon_time.png" alt="Engine" class="icon-inline" /><span id="engine_status_indicator">‚óè</span></strong
      >
    </li>
    <li class="desktop-only">
      <strong title="Ticks per Second"
        ><img src="img/ui/icons/icon_time.png" alt="TPS" class="icon-inline" /><span id="tps_display">0</span></strong
      >
    </li>
    <li class="desktop-only">
      <strong title="Frames per Second (16.7ms budget)"
        ><img src="img/ui/icons/icon_time.png" alt="FPS" class="icon-inline" /><span id="fps_display">0</span></strong
      >
    </li>
  </ul>
  <ul>
    <li>
      <button
        id="fullscreen_toggle"
        class="secondary"
        title="Toggle Fullscreen"
      >
        ‚õ∂
      </button>
    </li>
    <li>
      <button id="splash_close_btn" class="secondary" title="Back to Splash">
        ‚úñ
      </button>
    </li>
  </ul>
</nav>

<!-- MAIN CONTENT -->
<main id="main">
  <!-- PARTS SIDEBAR -->
  <aside id="parts_section">
    <button id="parts_panel_toggle" aria-label="Toggle parts panel">‚ò∞</button>
    <div class="parts_header">
      <div class="parts_tabs">
        <button
          class="parts_tab active"
          id="tab_power"
          data-tab="power"
          title="Power Creation"
        >
          <img src="img/ui/icons/icon_power.png" alt="Power" />
        </button>
        <button
          class="parts_tab"
          id="tab_heat"
          data-tab="heat"
          title="Heat Management"
        >
          <img src="img/ui/icons/icon_heat.png" alt="Heat" />
        </button>
        <button
          class="parts_tab"
          id="tab_misc1"
          data-tab="misc1"
          title="Other"
          disabled
        >
          <span role="img" aria-label="Locked">üîí</span>
        </button>
        <button
          class="parts_tab"
          id="tab_misc2"
          data-tab="misc2"
          title="Other"
          disabled
        >
          <span role="img" aria-label="Locked">üîí</span>
        </button>
        <button
          id="parts_help_toggle"
          class="parts_help_btn"
          title="Toggle help mode - click to show part information instead of placing parts"
          aria-label="Toggle help mode"
        >
          ?
        </button>
      </div>
    </div>
    <div id="parts_tab_contents">
      <div id="parts_tab_power" class="parts_tab_content active">
        <hgroup>
          <h4>Cells</h4>
          <h6>Generate power and heat.</h6>
        </hgroup>
        <div id="cells" class="item-grid"></div>
        <hgroup>
          <h4>Reflectors</h4>
          <h6>Boost adjacent cell output.</h6>
        </hgroup>
        <div id="reflectors" class="item-grid"></div>
        <hgroup>
          <h4>Capacitors</h4>
          <h6>Increase reactor power capacity.</h6>
        </hgroup>
        <div id="capacitors" class="item-grid"></div>
        <hgroup>
          <h4>Particle Accelerators</h4>
          <h6>Generate Exotic Particles from heat.</h6>
        </hgroup>
        <div id="particleAccelerators" class="item-grid"></div>
      </div>
      <div id="parts_tab_heat" class="parts_tab_content">
        <hgroup>
          <h4>Vents</h4>
          <h6>Actively cool components.</h6>
        </hgroup>
        <div id="vents" class="item-grid"></div>
        <hgroup>
          <h4>Heat Exchangers</h4>
          <h6>Distribute heat between components.</h6>
        </hgroup>
        <div id="heatExchangers" class="item-grid"></div>
        <hgroup>
          <h4>Heat Inlets</h4>
          <h6>Move heat into the reactor core.</h6>
        </hgroup>
        <div id="heatInlets" class="item-grid"></div>
        <hgroup>
          <h4>Heat Outlets</h4>
          <h6>Move heat out of the reactor core.</h6>
        </hgroup>
        <div id="heatOutlets" class="item-grid"></div>
        <hgroup>
          <h4>Coolant Cells</h4>
          <h6>Absorb and contain heat.</h6>
        </hgroup>
        <div id="coolantCells" class="item-grid"></div>
        <hgroup>
          <h4>Reactor Plating</h4>
          <h6>Increase reactor heat capacity.</h6>
        </hgroup>
        <div id="reactorPlatings" class="item-grid"></div>
        <hgroup>
          <h4>Overflow Valves</h4>
          <h6>Transfer heat when input exceeds 80% containment.</h6>
        </hgroup>
        <div id="overflowValves" class="item-grid"></div>
        
        <hgroup>
          <h4>Top-up Valves</h4>
          <h6>Transfer heat when output drops below 20% containment.</h6>
        </hgroup>
        <div id="topupValves" class="item-grid"></div>
        
        <hgroup>
          <h4>Check Valves</h4>
          <h6>Transfer heat in one direction only.</h6>
        </hgroup>
        <div id="checkValves" class="item-grid"></div>
      </div>
    </div>
    <nav id="controls_nav">
      <button id="auto_sell_toggle" class="secondary outline" title="Auto Sell">
        Auto Sell
      </button>
      <button id="auto_buy_toggle" class="secondary outline" title="Auto Buy">
        Auto Buy
      </button>
      <button id="time_flux_toggle" class="secondary outline" title="Time Flux">
        Time Flux
      </button>
      <button
        id="heat_control_toggle"
        class="secondary outline"
        title="Heat Ctrl"
      >
        Auto Heat
      </button>
      <button id="pause_toggle" class="contrast" title="Pause/Play">
        Pause
      </button>
    </nav>
  </aside>

      <div id="main_content_wrapper">
      <!-- Only show objectives on reactor page -->

      <!-- ENHANCED OBJECTIVES SECTION -->
      <div id="objectives_section">
        <!-- Legacy content for backward compatibility -->
        <div id="objectives_content">
          <div id="objective_title_wrapper">
            <span id="objective_title"
              ><span><!-- Objective text will be injected here --></span></span
            >
            <span id="objective_reward"></span>
          </div>
        </div>

        <!-- NEW ENHANCED OBJECTIVES UI -->
        <div id="objectives_container" class="mobile-objectives-container">

          <!-- ALWAYS VISIBLE HEADER (THE 'HANDLE' FOR THE DRAWER) -->
          <header id="objectives_header" class="objectives-header">
              <div class="objective-main-info">
                  <h2 id="objective_current_title" class="objective-title-compact"></h2>
                  <div class="objective-progress-bar-container">
                      <div id="objective_current_progress_bar" class="objective-progress-bar"></div>
                  </div>
              </div>
              <div class="objectives-header-actions">
                  <button id="objective_claim_btn_compact" class="objective-claim-btn-compact" disabled>Claim</button>
                  <button id="objective_claim_chapter_btn_compact" class="objective-claim-btn-compact chapter-claim-btn-compact" disabled>Complete</button>
                  <button id="objectives_toggle_btn" class="objectives-toggle-btn" aria-label="Toggle objectives panel">
                      <!-- Icon can be an SVG or an <img> tag -->
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                          <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                      </svg>
                  </button>
              </div>
          </header>

          <!-- EXPANDABLE CONTENT PANEL -->
          <div id="objectives_content_panel" class="objectives-content-panel">
              <!-- Chapter Information -->
              <div class="objectives-chapter-info">
                  <h3 id="objective_chapter_title"></h3>
                  <div class="chapter-progress-container">
                      <div class="chapter-progress-bar-container">
                          <div id="objective_chapter_progress_bar" class="chapter-progress-bar"></div>
                      </div>
                      <span id="objective_chapter_progress_text"></span>
                  </div>
              </div>

              <hr class="objective-divider">

              <!-- Current Objective Details -->
              <div class="objective-details">
                  <p id="objective_current_description" class="objective-description"></p>
                  <p id="objective_flavor_text" class="objective-flavor-text" hidden></p>
                  <p id="objective_current_progress_text" class="objective-progress-text"></p>
                  <div id="objective_reward" class="objective-reward"></div>
              </div>

              <!-- Claim Buttons -->
              <button id="objective_claim_btn" class="objective-claim-btn" disabled>Claim Reward</button>
              <button id="objective_claim_chapter_btn" class="objective-claim-btn chapter-claim-btn" disabled>Complete Chapter</button>
          </div>
        </div>
      </div>

    <!-- End reactor-only objectives -->

    <div id="page_content_area">
      <!-- Content will be loaded dynamically -->
    </div>

    <!-- TOOLTIP -->
    <div id="tooltip" class="hidden">
      <div id="tooltip_data">
        <!-- Content injected by TooltipManager -->
      </div>
      <button id="tooltip_close_btn" title="Close">√ó</button>
    </div>
  </div>
</main>

<!-- Modal for Copy/Paste Data -->
<div id="reactor_copy_paste_modal" class="hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="reactor_copy_paste_modal_title">Reactor Layout</h3>
      <button id="reactor_copy_paste_close_btn" title="Close">√ó</button>
    </div>
    <textarea id="reactor_copy_paste_text" style="width:100%;min-height:80px;" placeholder="Paste reactor layout data here..."></textarea>
    <div id="reactor_copy_paste_cost"></div>
    <div class="modal-actions">
      <button id="reactor_copy_paste_confirm_btn" class="hidden">Action</button>
    </div>
  </div>
</div>
<!-- End Copy/Paste UI -->

<!-- INFO BAR (FOOTER) -->
<footer id="info_bar">
  <!-- Desktop Layout (Single Row) -->
  <div class="info-bar-desktop">
    <button
      class="info-item power"
      id="info_bar_power_btn_desktop"
      type="button"
      tabindex="0"
      aria-label="Sell Power"
    >
      <img src="img/ui/icons/icon_power.png" alt="Power" class="icon" />
      <span class="value" id="info_power_desktop">100</span>
      <span class="denom" id="info_power_denom_desktop">/100</span>
    </button>
    <span class="info-item money"
      ><img src="img/ui/icons/icon_cash.png" alt="Cash" class="icon" />
      <span class="value" id="info_money_desktop">20.6K</span></span
    >
        <span class="info-item ep" id="info_ep_desktop">
      <span class="ep-content" style="display: none;">
        <span class="icon">üß¨</span>
        <span class="value" id="info_ep_value_desktop">0</span>
      </span>
    </span>
    <button
      class="info-item heat"
      id="info_bar_heat_btn_desktop"
      type="button"
      tabindex="0"
      aria-label="Reduce Heat"
    >
      <img src="img/ui/icons/icon_heat.png" alt="Heat" class="icon" />
      <span class="value" id="info_heat_desktop">496</span>
      <span class="denom" id="info_heat_denom_desktop">/1K</span>
    </button>

  </div>

  <!-- Mobile Layout (Two Rows) -->
  <div class="info-bar-mobile">
    <div class="info-row info-main">
      <button
        class="info-item power"
        id="info_bar_power_btn"
        type="button"
        tabindex="0"
        aria-label="Sell Power"
      >
        <img src="img/ui/icons/icon_power.png" alt="Power" class="icon" />
        <span class="value" id="info_power">100</span>
      </button>
      <span class="info-item money"
        ><img src="img/ui/icons/icon_cash.png" alt="Cash" class="icon" />
        <span class="value" id="info_money">20.6K</span></span
      >
      <button
        class="info-item heat"
        id="info_bar_heat_btn"
        type="button"
        tabindex="0"
        aria-label="Reduce Heat"
      >
        <img src="img/ui/icons/icon_heat.png" alt="Heat" class="icon" />
        <span class="value" id="info_heat">496</span>
      </button>
    </div>
    <div class="info-row info-denom">
      <span class="info-item power"
        ><span class="denom" id="info_power_denom">/100</span></span
      >
                 <span class="info-item ep" id="info_ep">
             <span class="ep-content" style="display: none;">
               <span class="icon">üß¨</span>
               <span class="value" id="info_ep_value">0</span>
             </span>
           </span>
      <span class="info-item heat"
        ><span class="denom" id="info_heat_denom">/1K</span></span
      >
    </div>
  </div>
</footer>

<!-- BOTTOM NAV (MOBILE) -->
<footer id="bottom_nav">
  <nav>
    <ul>
      <li>
        <button data-page="reactor_section" class="secondary active">
          Reactor
        </button>
      </li>
      <li>
        <button data-page="upgrades_section" class="secondary">Upgrades</button>
      </li>
      <li>
        <button data-page="experimental_upgrades_section" class="secondary">
          Research
        </button>
      </li>
    </ul>
  </nav>
</footer>
