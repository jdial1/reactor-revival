<!-- TOP NAVIGATION -->
<nav id="main_top_nav" class="nav-bar-row">
  <!-- Left Group: Navigation Links -->
  <ul class="nav-group-left">
    <li>
      <button data-page="reactor_section" class="active">Reactor</button>
    </li>
    <li>
      <button data-page="upgrades_section">Upgrades</button>
      <!-- Indicator dot injected via JS -->
    </li>
    <li>
      <button data-page="experimental_upgrades_section">Research</button>
    </li>
    <li>
      <button data-page="leaderboard_section" title="Leaderboard" aria-label="Leaderboard">üèÜ</button>
    </li>
  </ul>

  <!-- Center Group: Stats (Desktop) -->
  <ul id="reactor_stats" class="desktop-only">
    <li>
      <strong title="Total heat venting per tick">
        <img src="img/ui/icons/icon_vent.png" alt="Vent" class="icon-inline" />
        <span id="stats_vent">0</span>
      </strong>
    </li>
    <li>
      <strong title="Power per tick">
        <img src="img/ui/icons/icon_power.png" alt="Power" class="icon-inline" />
        <span id="stats_power">0</span>
      </strong>
    </li>
    <li>
      <strong title="Heat per tick">
        <img src="img/ui/icons/icon_heat.png" alt="Heat" class="icon-inline" />
        <span id="stats_heat">0</span>
      </strong>
    </li>
  </ul>

  <ul id="engine_status" class="desktop-only">
     <li>
        <strong title="Tick Rate">
            <img src="img/ui/icons/icon_time.png" alt="TPS" class="icon-inline" />
            <span id="tps_display">0</span>
        </strong>
     </li>
  </ul>

  <!-- Right Group: System Controls -->
  <ul class="nav-group-right">
    <li>
      <button id="user_account_btn" title="Account" aria-label="User Account">üë§</button>
    </li>
    <li>
      <button id="fullscreen_toggle" title="Toggle Fullscreen" aria-label="Toggle Fullscreen">‚õ∂</button>
    </li>
    <li>
      <button id="settings_btn" title="Settings" aria-label="Settings">‚öôÔ∏è</button>
    </li>
    <li>
      <button id="splash_close_btn" title="Exit to Title" aria-label="Exit to Title">‚úñ</button>
    </li>
  </ul>
</nav>

<!-- MOBILE PASSIVE TOP BAR (EP | Money | Pause) - visible only when width <= 900px -->
<div id="mobile_passive_top_bar" class="mobile-passive-top-bar" aria-hidden="true">
  <span class="passive-top-ep">
    <span class="passive-top-icon" aria-hidden="true">&#129516;</span>
    <span id="mobile_passive_ep">0</span>
  </span>
  <span class="passive-top-money">
    <span id="mobile_passive_money_value">0</span>
  </span>
  <button type="button" id="mobile_passive_pause_btn" class="passive-top-pause" aria-label="Pause" title="Pause">
    <img src="img/ui/nav/nav_pause.png" alt="" class="passive-pause-icon pause-icon" />
    <img src="img/ui/nav/nav_play.png" alt="" class="passive-pause-icon play-icon" />
  </button>
</div>

<!-- MAIN CONTENT -->
<main id="main">
  <!-- PARTS SIDEBAR / BOTTOM SHEET -->
  <aside id="parts_section" class="collapsed">
    <div class="parts_sheet_handle" id="parts_sheet_handle"></div>
    <div class="parts_header">
      <div class="parts_tabs parts_categories_carousel">
        <button
          class="parts_tab active"
          id="tab_power"
          data-tab="power"
          title="Power Creation"
          aria-label="Power Creation"
        >
          <img src="img/ui/icons/icon_power.png" alt="Power" />
          <span class="parts_tab_label">Power</span>
        </button>
        <button
          class="parts_tab"
          id="tab_heat"
          data-tab="heat"
          title="Heat Management"
          aria-label="Heat Management"
        >
          <img src="img/ui/icons/icon_heat.png" alt="Heat" />
          <span class="parts_tab_label">Heat</span>
        </button>
        <button
          id="parts_help_toggle"
          class="parts_help_btn"
          title="Toggle help mode - click to show part information instead of placing parts"
          aria-label="Toggle help mode"
        >
          ?
        </button>
      </div>
    </div>
    <div id="parts_tab_contents">
      <div id="parts_tab_power" class="parts_tab_content active">
        <hgroup>
          <h4>Cells</h4>
          <h6>Generate power and heat.</h6>
        </hgroup>
        <div id="cells" class="item-grid"></div>
        <hgroup>
          <h4>Reflectors</h4>
          <h6>Boost adjacent cell output.</h6>
        </hgroup>
        <div id="reflectors" class="item-grid"></div>
        <hgroup>
          <h4>Capacitors</h4>
          <h6>Increase reactor power capacity.</h6>
        </hgroup>
        <div id="capacitors" class="item-grid"></div>
        <hgroup>
          <h4>Particle Accelerators</h4>
          <h6>Generate Exotic Particles from heat.</h6>
        </hgroup>
        <div id="particleAccelerators" class="item-grid"></div>
      </div>
      <div id="parts_tab_heat" class="parts_tab_content">
        <hgroup>
          <h4>Vents</h4>
          <h6>Actively cool components.</h6>
        </hgroup>
        <div id="vents" class="item-grid"></div>
        <hgroup>
          <h4>Heat Exchangers</h4>
          <h6>Distribute heat between components.</h6>
        </hgroup>
        <div id="heatExchangers" class="item-grid"></div>
        <hgroup>
          <h4>Heat Inlets</h4>
          <h6>Move heat into the reactor core.</h6>
        </hgroup>
        <div id="heatInlets" class="item-grid"></div>
        <hgroup>
          <h4>Heat Outlets</h4>
          <h6>Move heat out of the reactor core.</h6>
        </hgroup>
        <div id="heatOutlets" class="item-grid"></div>
        <hgroup>
          <h4>Coolant Cells</h4>
          <h6>Absorb and contain heat.</h6>
        </hgroup>
        <div id="coolantCells" class="item-grid"></div>
        <hgroup>
          <h4>Reactor Plating</h4>
          <h6>Increase reactor heat capacity.</h6>
        </hgroup>
        <div id="reactorPlatings" class="item-grid"></div>
        <hgroup>
          <h4>Overflow Valves</h4>
          <h6>Transfer heat when input exceeds 80% containment.</h6>
        </hgroup>
        <div id="overflowValves" class="item-grid"></div>
        
        <hgroup>
          <h4>Top-up Valves</h4>
          <h6>Transfer heat when output drops below 20% containment.</h6>
        </hgroup>
        <div id="topupValves" class="item-grid"></div>
        
        <hgroup>
          <h4>Check Valves</h4>
          <h6>Transfer heat in one direction only.</h6>
        </hgroup>
        <div id="checkValves" class="item-grid"></div>
      </div>
    </div>
    <nav id="controls_nav">
      <button id="auto_sell_toggle" class="secondary outline" title="Auto Sell">
        <img src="img/ui/icons/icon_cash.png" alt="Auto Sell" class="control-icon" />
        <span class="control-text">Auto Sell</span>
      </button>
      <button id="auto_buy_toggle" class="secondary outline" title="Auto Buy">
        <img src="img/ui/icons/icon_cash_outline.svg" alt="Auto Buy" class="control-icon" />
        <span class="control-text">Auto Buy</span>
      </button>
      <button id="time_flux_toggle" class="secondary outline" title="Time Flux">
        <img src="img/ui/icons/icon_time.png" alt="Time Flux" class="control-icon" />
        <span class="control-text">Time Flux</span>
      </button>
      <button
        id="heat_control_toggle"
        class="secondary outline"
        title="Heat Ctrl"
      >
        <img src="img/ui/icons/icon_heat.png" alt="Auto Heat" class="control-icon" />
        <span class="control-text">Auto Heat</span>
      </button>
      <button id="pause_toggle" class="contrast" title="Pause/Play">
        <img src="img/ui/nav/nav_pause.png" alt="Pause" class="control-icon pause-icon" />
        <img src="img/ui/nav/nav_play.png" alt="Resume" class="control-icon play-icon" />
        <span class="control-text">Pause</span>
      </button>
      <button id="user_account_btn_mobile" class="secondary outline" title="Account">
        <span class="control-icon" style="font-size: 1.5em;">üë§</span>
        <span class="control-text">Account</span>
      </button>
    </nav>
    <button id="parts_close_btn" class="pixel-btn contrast parts-close-btn" type="button">Close</button>
  </aside>

      <div id="main_content_wrapper">
      <!-- Only show objectives on reactor page -->

      <button id="objectives_toast_btn" class="objectives-toast-btn" aria-label="Show Objectives" aria-expanded="false" type="button">
        <span class="objectives-toast-icon">?</span>
        <span class="objectives-toast-title" id="objectives_toast_title"></span>
        <span class="objectives-claim-pill">Claim</span>
      </button>

    <!-- End reactor-only objectives -->

    <div id="page_content_area">
      <!-- Content will be loaded dynamically -->
    </div>

    <!-- TOOLTIP -->
    <div id="tooltip" class="hidden">
      <div id="tooltip_data">
        <!-- Content injected by TooltipManager -->
      </div>
      <button id="tooltip_close_btn" title="Close" aria-label="Close tooltip">√ó</button>
    </div>

    <!-- CONTEXT MODAL (Mobile Bottom Sheet for Grid Selection) -->
    <div id="context_modal" class="context-modal hidden">
      <div class="context-modal-handle"></div>
      <div class="context-modal-content">
        <div class="context-modal-header">
          <h3 id="context_modal_title" class="context-modal-title"></h3>
          <button id="context_modal_close" class="context-modal-close" aria-label="Close">√ó</button>
        </div>
        <div id="context_modal_body" class="context-modal-body">
          <!-- Content injected by UI -->
        </div>
        <div class="context-modal-actions">
          <button id="context_modal_sell" class="context-modal-sell-btn">Sell/Destroy</button>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Modal for Copy/Paste Data -->
<div id="reactor_copy_paste_modal" class="hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="reactor_copy_paste_modal_title">Reactor Layout</h3>
      <button id="reactor_copy_paste_close_btn" title="Close" aria-label="Close Modal">√ó</button>
    </div>
    <textarea id="reactor_copy_paste_text" style="width:100%;min-height:80px;" placeholder="Paste reactor layout data here..."></textarea>
    <div id="reactor_copy_paste_cost"></div>
    <div class="modal-actions">
      <button id="reactor_copy_paste_confirm_btn" class="hidden">Action</button>
    </div>
  </div>
</div>
<!-- End Copy/Paste UI -->

<!-- BUILD ROW (Above Control Deck, Reactor Page Only): 5 quick-select slots + build FAB -->
<div id="build_above_deck_row" class="build-above-deck-row">
  <div class="quick-select-slots" aria-label="Recent parts">
    <button type="button" class="quick-select-slot" data-index="0" aria-label="Recent part 1"></button>
    <button type="button" class="quick-select-slot" data-index="1" aria-label="Recent part 2"></button>
    <button type="button" class="quick-select-slot" data-index="2" aria-label="Recent part 3"></button>
    <button type="button" class="quick-select-slot" data-index="3" aria-label="Recent part 4"></button>
    <button type="button" class="quick-select-slot" data-index="4" aria-label="Recent part 5"></button>
    <button id="control_deck_build_fab" class="control-deck-fab" type="button" aria-label="Build Parts" title="Build Parts">
      <span class="control-deck-fab-icon" aria-hidden="true">‚Ä¶</span>
    </button>
  </div>
</div>

<!-- REACTOR CONTROL DECK (Bottom Anchor) -->
<footer id="reactor_control_deck" class="reactor-control-deck">
  <div class="control-deck-inner">
    <div class="control-deck-grid">
      <button
        class="control-deck-item power-capacitor"
        id="control_deck_power_btn"
        type="button"
        tabindex="0"
        aria-label="Sell Power"
      >
        <div class="control-deck-auto-sell-led" id="control_deck_auto_sell_led" aria-hidden="true"></div>
        <div class="control-deck-fill power-fill"></div>
        <div class="control-deck-content">
          <img src="img/ui/icons/icon_power.png" alt="Power" class="control-deck-icon" />
          <span class="control-deck-value" id="control_deck_power">100</span>
          <span class="control-deck-denom" id="control_deck_power_denom">/100</span>
        </div>
      </button>

      <div class="control-deck-item money-scoreboard" id="control_deck_money">
        <div class="control-deck-content">
          <img src="img/ui/icons/icon_cash.png" alt="Cash" class="control-deck-icon" />
          <span class="control-deck-value" id="control_deck_money_value">20.6K</span>
        </div>
        <div class="floating-text-container" id="floating_text_container"></div>
      </div>

      <button
        class="control-deck-item heat-vent"
        id="control_deck_heat_btn"
        type="button"
        tabindex="0"
        aria-label="Vent Heat"
      >
        <div class="control-deck-fill heat-fill"></div>
        <div class="control-deck-hazard-stripes"></div>
        <div class="control-deck-content">
          <img src="img/ui/icons/icon_heat.png" alt="Heat" class="control-deck-icon" />
          <span class="control-deck-value" id="control_deck_heat">496</span>
          <span class="control-deck-denom" id="control_deck_heat_denom">/1K</span>
        </div>
        <div class="steam-particles" id="steam_particles"></div>
      </button>
    </div>
  </div>
</footer>

<!-- INFO BAR (Legacy - for desktop compatibility) -->
<footer id="info_bar" class="info-bar-legacy">
  <!-- Desktop Layout (Single Row) -->
  <div class="info-bar-desktop">
    <button
      class="info-item power"
      id="info_bar_power_btn_desktop"
      type="button"
      tabindex="0"
      aria-label="Sell Power"
    >
      <img src="img/ui/icons/icon_power.png" alt="Power" class="icon" />
      <span class="value" id="info_power_desktop">100</span>
      <span class="denom" id="info_power_denom_desktop">/100</span>
    </button>
    <span class="info-item money"
      ><img src="img/ui/icons/icon_cash.png" alt="Cash" class="icon" />
      <span class="value" id="info_money_desktop">20.6K</span></span
    >
        <span class="info-item ep" id="info_ep_desktop">
      <span class="ep-content" style="display: none;">
        <span class="icon">üß¨</span>
        <span class="value" id="info_ep_value_desktop">0</span>
      </span>
    </span>
    <button
      class="info-item heat"
      id="info_bar_heat_btn_desktop"
      type="button"
      tabindex="0"
      aria-label="Reduce Heat"
    >
      <img src="img/ui/icons/icon_heat.png" alt="Heat" class="icon" />
      <span class="value" id="info_heat_desktop">496</span>
      <span class="denom" id="info_heat_denom_desktop">/1K</span>
    </button>
    <div class="info-item buffs" id="info_bar_buffs_desktop">
    </div>
  </div>

  <!-- Mobile Layout (Two Rows) - Hidden, using control deck instead -->
  <div class="info-bar-mobile" style="display: none;">
    <div class="info-row info-main">
      <button
        class="info-item power"
        id="info_bar_power_btn"
        type="button"
        tabindex="0"
        aria-label="Sell Power"
      >
        <img src="img/ui/icons/icon_power.png" alt="Power" class="icon" />
        <span class="value" id="info_power">100</span>
      </button>
      <span class="info-item money"
        ><img src="img/ui/icons/icon_cash.png" alt="Cash" class="icon" />
        <span class="value" id="info_money">20.6K</span></span
      >
      <button
        class="info-item heat"
        id="info_bar_heat_btn"
        type="button"
        tabindex="0"
        aria-label="Reduce Heat"
      >
        <img src="img/ui/icons/icon_heat.png" alt="Heat" class="icon" />
        <span class="value" id="info_heat">496</span>
      </button>
    </div>
    <div class="info-row info-denom">
      <span class="info-item power"
        ><span class="denom" id="info_power_denom">/100</span></span
      >
      <div class="info-item center-content">
        <span class="info-item ep" id="info_ep">
          <span class="ep-content" style="display: none;">
            <span class="icon">üß¨</span>
            <span class="value" id="info_ep_value">0</span>
          </span>
        </span>
        <div class="info-item buffs" id="info_bar_buffs">
        </div>
      </div>
      <span class="info-item heat"
        ><span class="denom" id="info_heat_denom">/1K</span></span
      >
    </div>
  </div>
</footer>

<!-- BOTTOM NAV (Global Navigation Bar) -->
<footer id="bottom_nav">
  <nav>
    <ul>
      <li>
        <button data-page="reactor_section" class="secondary active">
          Core
        </button>
      </li>
      <li>
        <button data-page="upgrades_section" class="secondary">Mods</button>
      </li>
      <li>
        <button data-page="experimental_upgrades_section" class="secondary">
          Tech
        </button>
      </li>
      <li>
        <button id="menu_tab_btn" class="secondary" aria-label="Menu">
          More
        </button>
      </li>
    </ul>
  </nav>
</footer>
